<template name="tileAdvancedOptions">
  <a href="#" class="btn btn-default geolocate" onclick="getLocation();"><i class="fa fa-location-arrow" aria-hidden="true"></i> Use my location</a>
  <a href="#" class="pull-right" id="advanced-toggle">Advanced <i class="fa fa-caret-down" aria-hidden="true"></i></a>
  <div id="advanced">
    <hr>
      <label>Tags</label>
      <input name="tags" id="tags" type="text" value="" data-role="tagsinput" class="form-control"/>
    <hr>
      <label>Location Search</label>
      <input name="locationSearch" id="locationSearch" type="text" value="" placeholder="Search for a location..." class="form-control"/>
      <div id="map" style="height:200px;"></div>
      <label>Latitude</label>
      <input name="lat" id="lat" type="number" step="any" value="" placeholder="Latitude" class="form-control">
      <label>Longitude</label>
      <input name="lng" id="lng" type="number" step="any" value="" placeholder="Longitude" class="form-control">
    <hr>
      <label>Attribution</label>
      <input name="attribution" id="attribution" type="text" value="" class="form-control" placeholder="Give credit here..."/>
    <hr>
  </div>

  <script>

    $("input#tags").tagsinput('items');

    //Show advanced location menu
    $("#advanced").css({'visibility':'hidden', 'position':'absolute'});
    $("#advanced-toggle").click(function() {
        $("#advanced").css({'visibility':'visible', 'position':'static'});
        $("#advanced-toggle").css({'visibility':'hidden'});
        google.maps.event.trigger(map, 'resize');
    });

    //Use Geolocation
    function getLocation(){
      $( ".geolocate" ).html('<i class="fa fa-spinner" aria-hidden="true"></i> Getting your location...');
      navigator.geolocation.getCurrentPosition(handleGetCurrentPosition, onPositionError);
    };
    function handleGetCurrentPosition(location){
      $("#lat").val(location.coords.latitude);
      $("#lng").val(location.coords.longitude);
      $( ".geolocate" ).html('<i class="fa fa-location-arrow" aria-hidden="true"></i> Located successfully');
      $( ".geolocate" ).addClass( "btn-success");
    };
    function onPositionError(){
      throwError("There was an issue getting your location.");
      $( ".geolocate" ).html('<i class="fa fa-exclamation" aria-hidden="true"></i> Could not get your location.');
      $( ".geolocate" ).addClass( "btn-warning");
    };
  </script>
</template>

<template name="tileAdvancedOptionsEdit">
  <a href="#" class="btn btn-default geolocate" onclick="getLocation();"><i class="fa fa-location-arrow" aria-hidden="true"></i> Use my location</a>
  <a href="#" class="pull-right" id="advanced-toggle">Advanced <i class="fa fa-caret-down" aria-hidden="true"></i></a>
  <div id="advanced">
    <hr>
      <label>Tags</label>
      <input name="tags" id="tags" type="text" value="{{tags}}" data-role="tagsinput" class="form-control" />
    <hr>
      <label>Location Search</label>
      <input name="locationSearch" id="locationSearch" type="text" value="" placeholder="Search for a location..." class="form-control"/>
      <div id="map" style="height:200px;"></div>
      <label>Latitude</label>
      <input name="lat" id="lat" type="number" step="any" placeholder="Latitude" class="form-control" value="{{latitude}}">
      <label>Longitude</label>
      <input name="lng" id="lng" type="number" step="any" placeholder="Longitude" class="form-control" value="{{longitude}}">
    <hr>
      <label>Attribution</label>
      <input name="attribution" id="attribution" type="text" value="{{attribution}}" data-role="tagsinput" class="form-control" placeholder="Give credit here" />
    <hr>
  </div>

  <script>
    $("input#tags").tagsinput('items');

    //Show advanced location menu
    $("#advanced").css({'visibility':'hidden', 'position':'absolute'});
    $("#advanced-toggle").click(function() {
        $("#advanced").css({'visibility':'visible', 'position':'static'});
        $("#advanced-toggle").css({'visibility':'hidden'});
        google.maps.event.trigger(map, 'resize');
    });

    //Use Geolocation
    function getLocation(){
      $( ".geolocate" ).html('<i class="fa fa-spinner" aria-hidden="true"></i> Getting your location...');
      navigator.geolocation.getCurrentPosition(handleGetCurrentPosition, onPositionError);
    };
    function handleGetCurrentPosition(location){
      $("#lat").val(location.coords.latitude);
      $("#lng").val(location.coords.longitude);
      $( ".geolocate" ).html('<i class="fa fa-location-arrow" aria-hidden="true"></i> Located successfully');
      $( ".geolocate" ).addClass( "btn-success");
    };
    function onPositionError(){
      throwError("There was an issue getting your location.");
      $( ".geolocate" ).html('<i class="fa fa-exclamation" aria-hidden="true"></i> Could not get your location.');
      $( ".geolocate" ).addClass( "btn-warning");
    };
  </script>
</template>
